(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{1957:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(5155),i=r(2115),n=r(2078),s=r(2553),l=r(9708),o=r(9996);let c=(0,n.Dk)().length?(0,n.Sx)():(0,n.Wp)({apiKey:"AIzaSyAYEG2XdbuQlGflMwppjtj54ur4jKs89-A",authDomain:"kaamon6363.firebaseapp.com",projectId:"kaamon6363",storageBucket:"kaamon6363.firebasestorage.app",messagingSenderId:"582122881331",appId:"1:582122881331:web:8fac47d3e8646e56a47e46",measurementId:"G-7GFJK5G724"}),d=(0,s.xI)(c),u=(0,l.aU)(c),m=(0,o.c7)(c);function x(){let[e,t]=(0,i.useState)(1),[r,n]=(0,i.useState)("+91"),[c,x]=(0,i.useState)(""),[p,g]=(0,i.useState)(null),[h,f]=(0,i.useState)(null),[b,y]=(0,i.useState)(!1),[j,N]=(0,i.useState)("Sending OTP..."),[w,v]=(0,i.useState)(""),[C,k]=(0,i.useState)(!1),[P,S]=(0,i.useState)([]),[q,A]=(0,i.useState)([]),E=(0,i.useRef)(null),[T,V]=(0,i.useState)({manufacturer:"",model:"",year:"",category:"",operatingHours:"",serialNumber:"",condition:"Used",locationCity:"",locationState:"",locationZip:"",askingPrice:"",description:"",sellerName:"",sellerEmail:""});(0,i.useEffect)(()=>{if(E.current&&!window.recaptchaVerifier)try{window.recaptchaVerifier=new s.kT(d,E.current,{size:"invisible",callback:()=>console.log("reCAPTCHA verified"),"expired-callback":()=>{var e;console.log("reCAPTCHA expired, re-rendering"),null==(e=window.recaptchaVerifier)||e.render().catch(e=>console.error(e))}}),window.recaptchaVerifier.render().then(e=>{console.log("reCAPTCHA widget rendered with ID:",e)}),console.log("reCAPTCHA verifier initialized")}catch(e){console.error("Error initializing reCAPTCHA:",e),v("Could not initialize verification. Please refresh the page.")}return()=>{window.recaptchaVerifier&&window.recaptchaVerifier.clear()}},[d]);let D=async e=>{if(e.preventDefault(),v(""),y(!0),N("Sending OTP..."),!window.recaptchaVerifier){v("reCAPTCHA not initialized. Refresh page."),y(!1);return}try{let e=r.replace(/[\s\-()]/g,"");e.startsWith("+")||(e=10===e.length?"+91".concat(e):"+".concat(e)),console.log("Attempting to send OTP to:",e);let a=await (0,s.ik)(d,e,window.recaptchaVerifier);f(a),t(2)}catch(e){if(console.error("OTP error:",e),"auth/internal-error"===e.code&&E.current){console.log("Attempting to recreate reCAPTCHA verifier...");try{window.recaptchaVerifier&&window.recaptchaVerifier.clear(),window.recaptchaVerifier=new s.kT(d,E.current,{size:"invisible"}),await window.recaptchaVerifier.render(),v("Please try sending the code again.")}catch(e){v("Failed to initialize verification. Please refresh the page.")}}else v(e.message||"Failed to send OTP")}finally{y(!1)}},H=async e=>{if(e.preventDefault(),v(""),N("Verifying..."),y(!0),!h){v("Verification session expired. Please request a new OTP."),y(!1),t(1);return}try{let e=await h.confirm(c);g(e.user),t(3),v("")}catch(e){console.error(e),v("Invalid OTP. Please check the code and try again.")}finally{y(!1)}},I=e=>{let{name:t,value:r}=e.target;V(e=>({...e,[t]:r}))},U=e=>{if(e.target.files){let t=Array.from(e.target.files).slice(0,5);S(t);let r=t.map(e=>URL.createObjectURL(e));q.forEach(e=>URL.revokeObjectURL(e)),A(r)}},F=async e=>{if(e.preventDefault(),!p)return void v("User not verified. Cannot submit.");v(""),N("Submitting..."),y(!0);try{N("Uploading images...");let e=[];for(let t of P){let r=(0,o.KR)(m,"equipments/".concat(p.uid,"/").concat(Date.now(),"_").concat(t.name)),a=await (0,o.D)(r,t),i=await (0,o.qk)(a.ref);e.push(i)}N("Finalizing registration..."),await (0,l.gS)((0,l.rJ)(u,"equipments"),{...T,imageUrls:e,ownerPhoneNumber:p.phoneNumber,ownerUid:p.uid,year:T.year?parseInt(T.year,10):null,operatingHours:T.operatingHours?parseInt(T.operatingHours,10):null,askingPrice:T.askingPrice?parseFloat(T.askingPrice):null,createdAt:new Date}),k(!0),setTimeout(()=>{window.location.href="/dashboard"},2500)}catch(e){console.error("Error adding document: ",e),v("Failed to register equipment. Please try again."),y(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("style",{children:"\n        .input-field {\n          display: block; width: 100%; border-width: 1px;\n          border-color: #D1D5DB; padding: 0.75rem; border-radius: 0.5rem;\n          box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n          transition: border-color 0.2s, box-shadow 0.2s;\n        }\n        .input-field:focus {\n          outline: none; border-color: #3B82F6;\n          box-shadow: 0 0 0 2px #BFDBFE;\n        }\n      "}),(0,a.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4 font-sans",children:(0,a.jsxs)("div",{className:"w-full max-w-2xl bg-white p-8 rounded-xl shadow-lg",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold mb-6 text-center text-gray-800",children:"Register Your Equipment"}),w&&(0,a.jsx)("p",{className:"bg-red-100 text-red-700 p-3 rounded-lg mb-4 text-center border border-red-200",children:w}),(()=>{switch(e){case 1:return(0,a.jsxs)("form",{onSubmit:D,className:"flex flex-col gap-4",children:[(0,a.jsx)("p",{className:"text-center text-gray-600 mb-2",children:"First, let's verify your phone number."}),(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg text-sm text-gray-700 mb-2 border border-blue-200",children:[(0,a.jsx)("p",{className:"font-semibold mb-1",children:"Please enter your number with country code:"}),(0,a.jsx)("p",{children:"Examples: +919876543210 (India), +11234567890 (US)"})]}),(0,a.jsx)("input",{type:"tel",value:r,onChange:e=>n(e.target.value),placeholder:"+919876543210",className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition",required:!0}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:b?j:"Send Verification Code"})]});case 2:return(0,a.jsxs)("form",{onSubmit:H,className:"flex flex-col gap-4",children:[(0,a.jsxs)("p",{className:"text-center text-gray-600",children:["Enter the 6-digit code sent to ",r]}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>x(e.target.value),placeholder:"123456",className:"border p-3 rounded-lg text-center tracking-[0.5em] focus:ring-2 focus:ring-green-500 focus:outline-none transition",maxLength:6,required:!0}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:b?j:"Verify & Continue"}),(0,a.jsx)("button",{onClick:()=>{t(1),v(""),x("")},type:"button",className:"text-sm text-blue-600 hover:underline mt-2",children:"Change phone number"})]});case 3:if(C)return(0,a.jsxs)("div",{className:"text-center transition-opacity duration-500",children:[(0,a.jsx)("div",{className:"mx-auto bg-green-100 rounded-full h-16 w-16 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"h-10 w-10 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mt-4",children:"Success!"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Your equipment has been registered successfully."}),(0,a.jsx)("p",{className:"text-gray-500 mt-1",children:"Redirecting you to the dashboard..."})]});return(0,a.jsxs)("form",{onSubmit:F,className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[(0,a.jsx)("h3",{className:"md:col-span-2 text-xl font-semibold text-gray-700 border-b pb-2 mb-2",children:"Equipment Details"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Manufacturer"}),(0,a.jsx)("input",{type:"text",name:"manufacturer",value:T.manufacturer,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Model"}),(0,a.jsx)("input",{type:"text",name:"model",value:T.model,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Year"}),(0,a.jsx)("input",{type:"number",name:"year",value:T.year,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,a.jsx)("input",{type:"text",name:"category",value:T.category,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Operating Hours"}),(0,a.jsx)("input",{type:"number",name:"operatingHours",value:T.operatingHours,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Serial Number"}),(0,a.jsx)("input",{type:"text",name:"serialNumber",value:T.serialNumber,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Asking Price ($)"}),(0,a.jsx)("input",{type:"number",step:"0.01",name:"askingPrice",value:T.askingPrice,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Condition"}),(0,a.jsxs)("select",{name:"condition",value:T.condition,onChange:I,className:"mt-1 input-field",children:[(0,a.jsx)("option",{children:"New"}),(0,a.jsx)("option",{children:"Used"}),(0,a.jsx)("option",{children:"Well-Maintained"}),(0,a.jsx)("option",{children:"Refurbished"})]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-1",children:[(0,a.jsx)("input",{type:"text",name:"locationCity",value:T.locationCity,onChange:I,placeholder:"City",className:"input-field",required:!0}),(0,a.jsx)("input",{type:"text",name:"locationState",value:T.locationState,onChange:I,placeholder:"State / Province",className:"input-field",required:!0}),(0,a.jsx)("input",{type:"text",name:"locationZip",value:T.locationZip,onChange:I,placeholder:"ZIP / Postal Code",className:"input-field",required:!0})]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,a.jsx)("textarea",{name:"description",value:T.description,onChange:I,className:"mt-1 input-field",rows:4,required:!0})]}),(0,a.jsx)("h3",{className:"md:col-span-2 text-xl font-semibold text-gray-700 border-b pb-2 mb-2 mt-4",children:"Equipment Images"}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Photos (Up to 5)"}),(0,a.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:U,className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),(0,a.jsx)("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4",children:q.map((e,t)=>(0,a.jsx)("img",{src:e,alt:"Preview ".concat(t+1),className:"w-full h-24 object-cover rounded-lg shadow-md"},t))})]}),(0,a.jsx)("h3",{className:"md:col-span-2 text-xl font-semibold text-gray-700 border-b pb-2 mb-2 mt-4",children:"Seller Information"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),(0,a.jsx)("input",{type:"text",name:"sellerName",value:T.sellerName,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email Address"}),(0,a.jsx)("input",{type:"email",name:"sellerEmail",value:T.sellerEmail,onChange:I,className:"mt-1 input-field",required:!0})]}),(0,a.jsx)("div",{className:"md:col-span-2 mt-6",children:(0,a.jsx)("button",{type:"submit",disabled:b||C,className:"w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:b?j:"Complete Registration"})})]});default:return null}})(),(0,a.jsx)("div",{ref:E})]})})]})}},5663:(e,t,r)=>{Promise.resolve().then(r.bind(r,1957))}},e=>{e.O(0,[135,965,31,441,493,358],()=>e(e.s=5663)),_N_E=e.O()}]);